<!DOCTYPE html>
<!-- saved from url=(0047)https://kane-gc.github.io/DreamofFingingTeaWeb/ -->
<html lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>梦华寻茶录</title>
<style>

.nav-buttons {
  position: absolute;
  bottom: 20px;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-between; 
  align-items: center;        
  padding: 0 24px;          
  box-sizing: border-box;
}

.nav-btn {
  background: #8c1c13;
  color: #f8f4e9;
  border: none;
  padding: 10px 20px;
  border-radius: 20px;
  font-size: 14px;
  letter-spacing: 2px;
  flex: none;                
}
.nav-btn:disabled { background: #d4c9a8; cursor: not-allowed; }

.fire{
  position: absolute;
  bottom: 0px;             /* 盏下方 20 px */
  left: 50%;
  transform: translateX(-50%);
  width: 80px;
  height: 60px;
  background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M50 0c-10 20-30 30-30 50 0 20 15 35 35 35s35-15 35-35c0-20-20-30-30-50z' fill='%23ff6a00'/%3E%3Cpath d='M50 15c-7 14-20 20-20 32 0 12 9 22 22 22s22-10 22-22c0-12-13-18-20-32z' fill='%23ffad00'/%3E%3C/svg%3E") center/100% 100% no-repeat;
  filter: drop-shadow(0 0 8px #ff6a00);
  animation: flicker .4s infinite alternate;
}
@keyframes flicker{
  0%   { transform: translateX(-50%) scale(1); }
  100% { transform: translateX(-50%) scale(1.08); }
}
.hot-water {
  position: absolute;
  bottom: 120px;              
  left: 52%;
  transform: translateX(-50%);
  width: 80px;               
  height: 32px;             
  opacity: 0;
  transition: opacity .3s;
  pointer-events: none;     
}

/* 其余样式保留原始，新增补充样式 */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: "STSong","宋体",serif; background: #f8f4e9; height: 100vh; width: 100vw; overflow: hidden; position: relative; touch-action: none; }
.page { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity .5s; }
.hidden { opacity: 0; pointer-events: none; }
#cover { background: linear-gradient(180deg,#f8f4e9 0%,#e8e0d1 100%); }
.cover-title { font-size: 48px; color: #8c1c13; letter-spacing: 8px; margin-bottom: 20px; }
.cover-sub { font-size: 18px; color: #5c4a3d; letter-spacing: 4px; margin-bottom: 40px; }
.cover-img { width: 200px; height: 200px; border-radius: 50%; background: radial-gradient(circle,#d4c9a8 0%,#b8a98a 100%); box-shadow: 0 10px 30px rgba(0,0,0,.1); display: flex; align-items: center; justify-content: center; font-size: 24px; color: #5c4a3d; margin-bottom: 40px; }
.start-btn, .share-btn { background: #8c1c13; color: #f8f4e9; border: none; padding: 12px 40px; border-radius: 30px; font-size: 18px; letter-spacing: 4px; }
.share-btn { position: absolute; top: 20px; right: 20px; padding: 6px 18px; font-size: 14px; }
#intro { padding: 20px; text-align: center; }
#intro h2 { font-size: 32px; color: #4a0702; margin-bottom: 20px; letter-spacing: 6px; }
#intro p { max-width: 600px; font-size: 16px; line-height: 2; color: #5c4a3d; text-align: justify; text-indent: 2em; margin-bottom: 20px; }
.interaction-page { padding: 20px; }
.progress-bar { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); width: 80%; max-width: 300px; height: 6px; background: rgba(212,201,168,.5); border-radius: 3px; overflow: hidden; }
.progress-fill { height: 100%; background: linear-gradient(90deg,#8c1c13,#6e150f); border-radius: 3px; transition: width .3s; }
.interaction-title { font-size: 28px; color: #8c1c13; letter-spacing: 4px; margin-bottom: 20px; }
.interaction-area { width: 90%; max-width: 400px; height: 300px; background: rgba(255,255,255,.3); border: 2px solid #8c1c13; border-radius: 15px; position: relative; overflow: hidden; }
.operation-hint { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(140,28,19,.9); color: #f8f4e9; padding: 8px 16px; border-radius: 20px; font-size: 14px; letter-spacing: 2px; }
.tea-leaf { width: 60px; height: 60px; background: #4a7c59; border-radius: 50% 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); cursor: grab; }
.mill-stone { width: 120px; height: 120px; background: radial-gradient(circle,#8b7355 0%,#5c4a3d 100%); border-radius: 50%; position: absolute; bottom: 20px; right: 20px; display: flex; align-items: center; justify-content: center; color: #f8f4e9; font-size: 14px; }
.tea-cup { width: 100px; height: 80px; background: linear-gradient(180deg,#f8f4e9 0%,#e8e0d1 100%); border: 3px solid #8c1c13; border-radius: 0 0 50px 50px; position: absolute; bottom: 70px; left: 50%; transform: translateX(-50%); }
.tea-spoon { width: 80px; height: 20px; background: linear-gradient(90deg,#8c1c13 0%,#b8a98a 100%); border-radius: 10px; position: absolute; top: 50%; left: 20px; transform: translateY(-50%); cursor: grab; }
.tea-bowl { width: 150px; height: 100px; background: linear-gradient(180deg,#f8f4e9 0%,#e8e0d1 100%); border: 3px solid #8c1c13; border-radius: 50%; position: absolute; bottom: 30px; right: 30px; display: flex; align-items: center; justify-content: center; font-size: 14px; color: #5c4a3d; }
.whisk { width: 60px; height: 100px; background: linear-gradient(180deg,#8c1c13 0%,#b8a98a 100%); border-radius: 30px 30px 10px 10px; position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); cursor: grab; }
.drawing-canvas { width: 100%; height: 100%; background: linear-gradient(180deg,#d4c9a8 0%,#b8a98a 100%); border-radius: 10px; position: relative; }
.drawing-dot { position: absolute; width: 8px; height: 8px; background: #8c1c13; border-radius: 50%; pointer-events: none; }
.completion-message { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); background: #f8f4e9; border: 2px solid #8c1c13; border-radius: 15px; padding: 30px; text-align: center; display: none; z-index: 100; min-width: 280px; }
.completion-message h3 { font-size: 24px; color: #8c1c13; margin-bottom: 10px; }
.close-btn { position: absolute; top: 8px; right: 8px; background: none; border: none; font-size: 20px; color: #8c1c13; cursor: pointer; }

/* 新增补充样式 */
/* 击拂环节优化样式 */
.whisk-progress { position: absolute; top: 30px; left: 50%; transform: translateX(-50%); font-size: 16px; color: #8c1c13; font-weight: bold; letter-spacing: 2px; }
.slide-hint { position: absolute; top: 60px; left: 50%; transform: translateX(-50%); font-size: 12px; color: #5c4a3d; display: none; }
.tea-foam { position: absolute; border-radius: 50%; background: rgba(255,255,255,.9); opacity: 0; transition: opacity .2s; }

/* 茶百戏增强样式 */
.paint-btn-group { position: absolute; top: 20px; left: 0; right: 0; display: flex; justify-content: center; gap: 20px; }
.paint-btn { background: #8c1c13; color: #f8f4e9; border: none; padding: 6px 12px; border-radius: 15px; font-size: 12px; cursor: pointer; }
.paint-tip { position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); font-size: 14px; color: #5c4a3d; }

/* 文物鉴赏页面样式 */
.artifact-area { background: #e8e0d1; }
.model-container { width: 100%; height: 250px; position: absolute; top: 25px; left: 0; }
.model-tip { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); font-size: 14px; color: #8c1c13; text-align: center; width: 90%; }
.model-hint { position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); font-size: 12px; color: #5c4a3d; }

/* 知识扩展页面样式 */
.knowledge-page { padding: 20px; overflow-y: auto; }
.knowledge-container { max-width: 600px; width: 90%; }
.knowledge-title { font-size: 24px; color: #8c1c13; letter-spacing: 4px; margin-bottom: 20px; text-align: center; }
.knowledge-section { margin-bottom: 25px; opacity: 0; transform: translateY(10px); transition: opacity .5s, transform .5s; }
.knowledge-section.show { opacity: 1; transform: translateY(0); }
.knowledge-section h4 { font-size: 18px; color: #4a0702; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
.knowledge-section h4::before { content: ""; width: 8px; height: 8px; background: #8c1c13; border-radius: 50%; }
.knowledge-section p { font-size: 16px; line-height: 1.8; color: #5c4a3d; text-align: justify; }
.classic-quote { background: rgba(212,201,168,.3); padding: 12px; border-left: 3px solid #8c1c13; border-radius: 0 8px 8px 0; margin: 10px 0; font-style: italic; color: #4a0702; }
.tea-tool-group { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 15px; }
.tea-tool-card { width: calc(50% - 8px); background: #fff; border-radius: 8px; padding: 10px; box-shadow: 0 2px 5px rgba(0,0,0,.1); }
.tea-tool-card img { width: 100%; height: 80px; object-fit: contain; margin-bottom: 8px; }
.tea-tool-card p { font-size: 14px; color: #5c4a3d; text-align: center; line-height: 1.5; }

/* 结尾页样式 */
.result-page { background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 800'%3E%3Crect width='1000' height='800' fill='%23f8f4e9'/%3E%3Cpath d='M0 400 C150 300, 350 250, 500 250 C650 250, 850 300, 1000 400 L1000 800 L0 800 Z' fill='%23e8e0d1'/%3E%3C/svg%3E") center/cover no-repeat; }
.certificate { width: 90%; max-width: 500px; background: #fff; border-radius: 15px; padding: 30px 20px; box-shadow: 0 5px 20px rgba(0,0,0,.15); position: relative; margin-top: 50px; }
.certificate-border { border: 2px solid #8c1c13; border-radius: 10px; padding: 25px 15px; height: 100%; }
.certificate-title { font-size: 24px; color: #8c1c13; text-align: center; letter-spacing: 4px; margin-bottom: 20px; font-weight: bold; }
.certificate-content { margin-bottom: 20px; }
.painting-result { width: 180px; height: 180px; border-radius: 50%; background: #f8f4e9; border: 1px solid #d4c9a8; margin: 0 auto 20px; overflow: hidden; display: flex; align-items: center; justify-content: center; }
.painting-result img { width: 100%; height: 100%; object-fit: contain; }
.certificate-text { font-size: 16px; color: #5c4a3d; text-align: center; line-height: 1.8; margin-bottom: 15px; }
.certificate-date { font-size: 14px; color: #8c1c13; text-align: right; margin-top: 20px; }
.result-btn-group { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; width: 90%; max-width: 300px; }
.share-btn { background: #8c1c13; color: #f8f4e9; border: none; padding: 12px 0; border-radius: 25px; font-size: 16px; letter-spacing: 2px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
.share-btn svg { width: 20px; height: 20px; fill: #f8f4e9; }
.save-btn { background: #d4c9a8; color: #5c4a3d; border: none; padding: 12px 0; border-radius: 25px; font-size: 16px; letter-spacing: 2px; cursor: pointer; }
.back-home-btn { background: none; border: 1px solid #8c1c13; color: #8c1c13; padding: 10px 0; border-radius: 25px; font-size: 14px; letter-spacing: 2px; cursor: pointer; margin-top: 10px; }
.share-options { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); background: #f8f4e9; border: 2px solid #8c1c13; border-radius: 15px; padding: 25px; display: none; z-index: 200; min-width: 280px; }
.share-options h4 { font-size: 18px; color: #8c1c13; margin-bottom: 20px; text-align: center; }
.share-icon-group { display: flex; gap: 30px; justify-content: center; margin-bottom: 20px; }
.share-icon { width: 50px; height: 50px; border-radius: 50%; background: #d4c9a8; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: background .3s; }
.share-icon:hover { background: #8c1c13; }
.share-icon:hover svg { fill: #f8f4e9; }
.share-icon svg { width: 30px; height: 30px; fill: #5c4a3d; transition: fill .3s; }
.share-input { width: 100%; padding: 10px; border: 1px solid #d4c9a8; border-radius: 8px; margin-top: 10px; font-size: 14px; color: #5c4a3d; resize: none; outline: none; }
.share-input:focus { border-color: #8c1c13; }
</style>
<!-- 引入Three.js用于3D建盏模型 -->
<script src="./梦华寻茶录_files/three.min.js.下载"></script>
<script src="./梦华寻茶录_files/OrbitControls.js.下载"></script>
<!-- 引入html2canvas用于证书保存 -->
<script src="./梦华寻茶录_files/html2canvas.min.js.下载"></script>
</head>
<body>

<!-- 1 封面页 -->
<div id="cover" class="page hidden">
  <button class="share-btn" onclick="sharePage()">分享</button>
  <h1 class="cover-title">梦华寻茶录</h1>
  <p class="cover-sub">探寻宋代点茶之美</p>
  <div class="cover-img">宋代点茶</div>
  <button class="start-btn" onclick="toPage(&#39;intro&#39;)">开始寻茶</button>
</div>

<!-- 2 引言页 -->
<div id="intro" class="page">
  <h2>宋代点茶文化</h2>
  <p>宋代，是中国茶文化的鼎盛时期。点茶，作为宋代独特的饮茶方式，不仅是一种生活艺术，更是文人雅士精神追求的象征。</p>
  <p>“茶兴于唐，盛于宋”，宋人将茶事推向了一个前所未有的高度。从皇帝到百姓，皆以点茶为乐，形成了独特的茶文化体系。</p>
  <p>点茶技艺讲究“七汤点茶”，通过七次注汤、击拂，使茶末与水完美融合，形成细腻持久的泡沫，这就是宋人追求的“云脚渐开”之境。</p>
  <p>让我们一起走进宋人的茶世界，体验千年前的雅致生活。</p>
  <button class="nav-btn" onclick="toPage(&#39;roast&#39;)">进入体验</button>
</div>

<!-- 3 炙茶碾磨 -->
<div id="roast" class="page interaction-page hidden">
  <div class="progress-bar"><div class="progress-fill" style="width:20%"></div></div>
  <h2 class="interaction-title">炙茶碾磨</h2>
  <div class="interaction-area" id="roastArea">
    <div class="tea-leaf" id="leaf"></div>
    <div class="mill-stone">碾槽</div>
  </div>
  <div class="operation-hint">拖动茶叶到碾槽中</div>
  <div class="nav-buttons">
    <button class="nav-btn" onclick="toPage(&#39;intro&#39;)" disabled="">上一步</button>
    <button class="nav-btn" onclick="toPage(&#39;soup&#39;)">下一步</button>
  </div>
</div>

<!-- 4 候汤烫盏 -->
<div id="soup" class="page interaction-page hidden">
  <div class="progress-bar"><div class="progress-fill" style="width:40%"></div></div>
  <h2 class="interaction-title">候汤烫盏</h2>
  <div class="interaction-area" id="soupArea">
    <div class="tea-cup" id="teaCup"></div>
    <img class="hot-water" id="hotWater" src="data:image/svg+xml,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; viewBox=&#39;0 0 100 40&#39;%3E%3Cpath d=&#39;M0 20c10-10 30-10 40 0s30 10 40 0v20H0z&#39; fill=&#39;%23007BFF&#39;/%3E%3C/svg%3E" alt="热水">
    <div class="fire" id="fire"></div>
    <div class="hot-surface" id="hotSurface"></div>
  </div>
  <div class="operation-hint">点击水面加热</div>
  <div class="nav-buttons">
    <button class="nav-btn" onclick="toPage(&#39;roast&#39;)">上一步</button>
    <button class="nav-btn" onclick="toPage(&#39;powder&#39;)">下一步</button>
  </div>
</div>

<!-- 5 取粉注汤 -->
<div id="powder" class="page interaction-page hidden">
  <div class="progress-bar"><div class="progress-fill" style="width:60%"></div></div>
  <h2 class="interaction-title">取粉注汤</h2>
  <div class="interaction-area" id="powderArea">
    <div class="tea-spoon" id="spoon">茶勺</div>
    <div class="tea-bowl">茶盏</div>
  </div>
  <div class="operation-hint">拖动茶勺取粉</div>
  <div class="nav-buttons">
    <button class="nav-btn" onclick="toPage(&#39;soup&#39;)">上一步</button>
    <button class="nav-btn" onclick="toPage(&#39;whisk&#39;)">下一步</button>
  </div>
  <div id="powderDone" class="completion-message">
    <button onclick="closePowderDone()" style="position:absolute;top:8px;right:8px;background:none;border:none;font-size:20px;color:#8c1c13;cursor:pointer;">×</button>
    <h3>取粉完成！</h3>
    <p>茶末已放入茶盏，请继续注汤</p>
  </div>
</div>

<!-- 6 击拂（修复版，取消注释，确保元素可获取） -->
<div id="whisk" class="page interaction-page hidden">
  <div class="progress-bar"><div class="progress-fill" style="width:80%"></div></div>
  <h2 class="interaction-title">击拂</h2>
  <div class="interaction-area" id="whiskArea">
    <div class="tea-bowl" id="whiskBowl">茶盏</div>
    <div class="whisk" id="whiskTool" style="left: 50%; top: 50%; transform: translate(-50%, -50%);">茶筅</div>
    <div class="whisk-progress" id="whiskProgress">初现栗纹..</div>
    <div class="slide-hint" id="slideHint">滑动幅度需大于40px</div>
  </div>
  <div class="operation-hint">快速上下滑动茶筅击拂</div>
  <div class="nav-buttons">
    <button class="nav-btn" onclick="toPage(&#39;powder&#39;)">上一步</button>
    <button class="nav-btn" id="whiskNextBtn" onclick="toPage(&#39;art&#39;)" disabled="">下一步</button>
  </div>
</div>

<!-- 7 茶百戏（增强版） -->
<div id="art" class="page interaction-page hidden">
  <div class="progress-bar"><div class="progress-fill" style="width:85%"></div></div>
  <h2 class="interaction-title">茶百戏</h2>
  <div class="interaction-area">
    <div class="paint-btn-group">
      <button class="paint-btn" id="undoBtn" disabled="">撤销</button>
      <button class="paint-btn" id="resetBtn">重置</button>
    </div>
    <div class="drawing-canvas" id="canvas"></div>
    <div class="paint-tip">在茶汤泡沫上绘制你的专属图案</div>
  </div>
  <div class="operation-hint">手指/鼠标在绘制区滑动即可创作</div>
  <div class="nav-buttons">
    <button class="nav-btn" onclick="toPage(&#39;whisk&#39;)">上一步</button>
    <button class="nav-btn" id="artNextBtn" onclick="toPage(&#39;artifact&#39;)" disabled="">下一步</button>
  </div>
</div>

<!-- 新增 8 文物鉴赏页 -->
<div id="artifact" class="page interaction-page hidden">
  <div class="progress-bar"><div class="progress-fill" style="width:90%"></div></div>
  <h2 class="interaction-title">文物鉴赏 · 宋代建盏</h2>
  <div class="interaction-area artifact-area" id="artifactArea">
    <div class="model-container" id="modelContainer"><canvas width="396" height="250" style="display: block; width: 396px; height: 250px; touch-action: none;"></canvas></div>
    <div class="model-tip">单指旋转 · 双指缩放 欣赏建盏细节</div>
    <div class="model-hint">当前展示：北宋曜变天目盏（复现模型）</div>
  </div>
  <div class="operation-hint">探索建盏釉色与器型之美</div>
  <div class="nav-buttons">
    <button class="nav-btn" onclick="toPage(&#39;art&#39;)">上一步</button>
    <button class="nav-btn" onclick="toPage(&#39;knowledge&#39;)">下一步</button>
  </div>
</div>

<!-- 新增 9 知识扩展页 -->
<div id="knowledge" class="page hidden knowledge-page">
  <div class="progress-bar"><div class="progress-fill" style="width:95%"></div></div>
  <div class="knowledge-container">
    <h3 class="knowledge-title">宋代点茶文化深探</h3>
    
    <div class="knowledge-section" id="section1">
      <h4>点茶的历史地位</h4>
      <p>宋代是中国茶文化的鼎盛时期，点茶技艺由唐代煎茶发展而来，在北宋中期逐渐成熟，成为上至皇室贵族、下至文人百姓的主流饮茶方式。宋徽宗赵佶所著《大观茶论》，更是系统阐述了点茶的技法与审美标准，将点茶从“饮”提升至“艺”的层面。</p>
      <div class="classic-quote">“点茶之色，以纯白为上真。清白次之，灰白次之，黄白又次之。”——《大观茶论·色》</div>
    </div>
    
    <div class="knowledge-section" id="section2">
      <h4>核心茶器解析</h4>
      <p>宋代点茶对器具的要求极为严苛，不同器具承担着不同功能，共同构成点茶的完整流程：</p>
      <div class="tea-tool-group">
        <div class="tea-tool-card">
          <img src="data:image/svg+xml,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; viewBox=&#39;0 0 100 100&#39;%3E%3Crect width=&#39;100&#39; height=&#39;100&#39; fill=&#39;%23f8f4e9&#39;/%3E%3Cpath d=&#39;M30 70 L70 70 L65 30 L35 30 Z&#39; fill=&#39;%238b7355&#39;/%3E%3Ccircle cx=&#39;50&#39; cy=&#39;50&#39; r=&#39;15&#39; fill=&#39;%235c4a3d&#39;/%3E%3C/svg%3E" alt="茶碾">
          <p>茶碾：用于将团茶碾成细末，以石质为佳，确保茶末细腻均匀。</p>
        </div>
        <div class="tea-tool-card">
          <img src="data:image/svg+xml,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; viewBox=&#39;0 0 100 100&#39;%3E%3Crect width=&#39;100&#39; height=&#39;100&#39; fill=&#39;%23f8f4e9&#39;/%3E%3Ccircle cx=&#39;50&#39; cy=&#39;50&#39; r=&#39;30&#39; fill=&#39;%23d4c9a8&#39;/%3E%3Ccircle cx=&#39;50&#39; cy=&#39;50&#39; r=&#39;25&#39; fill=&#39;%23f8f4e9&#39;/%3E%3Cpath d=&#39;M50 25 L50 75 M25 50 L75 50&#39; stroke=&#39;%238c1c13&#39; stroke-width=&#39;2&#39;/%3E%3C/svg%3E" alt="茶罗">
          <p>茶罗：即茶筛，用细绢制成，筛选茶末，去除粗渣，保证茶汤细腻。</p>
        </div>
        <div class="tea-tool-card">
          <img src="data:image/svg+xml,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; viewBox=&#39;0 0 100 100&#39;%3E%3Crect width=&#39;100&#39; height=&#39;100&#39; fill=&#39;%23f8f4e9&#39;/%3E%3Cpath d=&#39;M40 80 L60 80 L55 30 L45 30 Z&#39; fill=&#39;%238c1c13&#39;/%3E%3Cpath d=&#39;M48 30 L52 30 L50 20&#39; stroke=&#39;%23b8a98a&#39; stroke-width=&#39;2&#39;/%3E%3Cpath d=&#39;M45 80 L55 80 L50 90&#39; fill=&#39;%23b8a98a&#39;/%3E%3C/svg%3E" alt="茶筅">
          <p>茶筅：竹制工具，用于击拂茶汤，使茶末与水充分融合，产生绵密泡沫。</p>
        </div>
        <div class="tea-tool-card">
          <img src="data:image/svg+xml,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; viewBox=&#39;0 0 100 100&#39;%3E%3Crect width=&#39;100&#39; height=&#39;100&#39; fill=&#39;%23f8f4e9&#39;/%3E%3Ccircle cx=&#39;50&#39; cy=&#39;60&#39; r=&#39;25&#39; fill=&#39;%235c4a3d&#39;/%3E%3Ccircle cx=&#39;50&#39; cy=&#39;60&#39; r=&#39;20&#39; fill=&#39;%233a2e26&#39;/%3E%3C/svg%3E" alt="建盏">
          <p>建盏：产自福建建阳，胎厚釉深，利于保温，是点茶的最佳器皿，以曜变、油滴釉为贵。</p>
        </div>
      </div>
    </div>
    
    <div class="knowledge-section" id="section3">
      <h4>点茶与文人生活</h4>
      <p>宋代文人将点茶与诗词、书画、琴棋结合，形成独特的“茶事雅集”。苏轼、陆游、杨万里等文人皆有咏茶诗作，如陆游“矮纸斜行闲作草，晴窗细乳戏分茶”，生动描绘了茶百戏的闲逸场景。点茶不仅是生活习惯，更成为文人精神世界的重要载体，体现了宋代“雅致内敛”的审美追求。</p>
    </div>
  </div>
  <div class="nav-buttons">
    <button class="nav-btn" onclick="toPage(&#39;artifact&#39;)">上一步</button>
    <button class="nav-btn" onclick="toPage(&#39;result&#39;)">完成体验</button>
  </div>
</div>

<!-- 新增 10 结尾成果页 -->
<div id="result" class="page hidden result-page">
  <div class="certificate">
    <div class="certificate-border">
      <h3 class="certificate-title">梦华寻茶录·点茶体验证书</h3>
      <div class="certificate-content">
        <div class="painting-result" id="paintingResult">
          <img src="https://kane-gc.github.io/DreamofFingingTeaWeb/" alt="您的茶百戏作品" id="resultImg">
        </div>
        <p class="certificate-text">恭喜您完成宋代点茶全流程体验，<br>亲身感受千年非遗的雅致与魅力，<br>成为传统文化的传播者！</p>
        <div class="certificate-date" id="certificateDate">体验日期：2024年X月X日</div>
      </div>
    </div>
  </div>
  
  <div class="result-btn-group">
    <button class="share-btn" id="shareBtn">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"></path>
      </svg>
      分享体验成果
    </button>
    <button class="save-btn" id="saveBtn">保存证书至相册</button>
    <button class="back-home-btn" onclick="toPage(&#39;cover&#39;)">返回首页重新体验</button>
  </div>
  
  <!-- 分享选项弹窗 -->
  <div class="share-options" id="shareOptions">
    <button class="close-btn" onclick="closeShareOptions()">×</button>
    <h4>选择分享平台</h4>
    <div class="share-icon-group">
      <div class="share-icon" id="wechatShare">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm6.605 4.61a8.502 8.502 0 011.93 5.314l-.013.215-.281.013c-1.782.084-3.368.799-4.662 1.874-.065-.01-.12-.024-.184-.03a3.855 3.855 0 00-.564-.037c-.326-.01-.65-.01-1.062.03-.06.005-.114.018-.184.028-1.28.97-2.875 1.688-4.664 1.874l-.28.013-.014-.214a8.588 8.588 0 011.935-5.314l.014.012.028.025.02.019a8.472 8.472 0 015.287-1.853c1.996 0 3.826.71 5.287 1.853l.02-.018.028-.025.015-.012zM15.116 7.333a1.806 1.806 0 00-2.43.095L11.3 8.813a.92.92 0 01-1.248.03L7.44 6.933a1.806 1.806 0 00-2.527 2.527l1.91 2.533a.92.92 0 01.03 1.248l-1.587 1.384a1.806 1.806 0 00.095 2.43l.084.076a1.806 1.806 0 002.43-.095l1.384-1.587a.92.92 0 011.248-.03l2.533 1.91a1.806 1.806 0 002.527-2.527l-1.91-2.533a.92.92 0 01-.03-1.248l1.587-1.384a1.806 1.806 0 00-.095-2.43l-.076-.084zM12 10.667a1.333 1.333 0 110 2.666 1.333 1.333 0 010-2.666z"></path>
        </svg>
      </div>
      <div class="share-icon" id="momentsShare">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M7.5 14.667c0-.944.763-1.708 1.708-1.708.944 0 1.708.763 1.708 1.708 0 .944-.763 1.708-1.708 1.708-.944 0-1.708-.763-1.708-1.708zm9.167-4.208c0-.944.763-1.708 1.708-1.708.944 0 1.708.763 1.708 1.708 0 .944-.763 1.708-1.708 1.708-.944 0-1.708-.763-1.708-1.708zm-5.208 0c0-.944.763-1.708 1.708-1.708.944 0 1.708.763 1.708 1.708 0 .944-.763 1.708-1.708 1.708-.944 0-1.708-.763-1.708-1.708zm-5.208 0c0-.944.763-1.708 1.708-1.708.944 0 1.708.763 1.708 1.708 0 .944-.763 1.708-1.708 1.708-.944 0-1.708-.763-1.708-1.708zM3 21h18v-2H3v2zm0-4h18v-2H3v2zm0-4h18v-2H3v2zm0-4h18V7H3v2zm0-4h18V3H3v2z"></path>
        </svg>
      </div>
      <div class="share-icon" id="weiboShare">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M18.24 15.225c.013.175.013.348.013.523 0 5.325-4.303 11.461-11.46 11.461-2.282 0-4.402-.661-6.186-1.809.324.037.636.05.973.05a8.07 8.07 0 0 0 5.001-1.721 4.036 4.036 0 0 1-3.767-2.793c.249.037.499.062.761.062.361 0 .724-.05 1.061-.137a4.027 4.027 0 0 1-3.23-3.953v-.05c.537.299 1.16.486 1.82.511a4.022 4.022 0 0 1-1.796-3.354c0-.748.199-1.434.548-2.032a11.457 11.457 0 0 0 8.306 4.215c-.062-.3-.1-.611-.1-.923a4.026 4.026 0 0 1 4.028-4.028c1.16 0 2.207.486 2.943 1.272a7.957 7.957 0 0 0 2.556-.973 4.02 4.02 0 0 1-1.771 2.22 8.073 8.073 0 0 0 2.319-.624 8.645 8.645 0 0 1-2.019 2.083z"></path>
        </svg>
      </div>
    </div>
    <textarea class="share-input" rows="2" placeholder="可添加分享文案：我在《梦华寻茶录》体验了宋代点茶，还创作了专属茶百戏！">我在《梦华寻茶录》体验了宋代点茶，还创作了专属茶百戏，一起来感受非遗之美！</textarea>
  </div>
</div>

<!-- 完成弹窗（带关闭按钮） -->
<div id="done" class="completion-message">
  <button onclick="closeDone()" style="position:absolute;top:8px;right:8px;background:none;border:none;font-size:20px;color:#8c1c13;cursor:pointer;">×</button>
  <h3>恭喜完成点茶体验！</h3>
  <p>您已成功体验了宋代点茶的全过程</p>
</div>

<script>
const pages = ['cover','intro','roast','soup','powder','whisk','art','artifact','knowledge','result'];
function toPage(id){
  pages.forEach(p=> document.getElementById(p).classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  
  // 知识页内容渐显
  if(id === 'knowledge'){
    setTimeout(()=>document.getElementById('section1').classList.add('show'), 100);
    setTimeout(()=>document.getElementById('section2').classList.add('show'), 600);
    setTimeout(()=>document.getElementById('section3').classList.add('show'), 1100);
  }
  
  // 结尾页日期填充
  if(id === 'result'){
    const date = new Date();
    const year = date.getFullYear();
    const month = date.getMonth() + 1;
    const day = date.getDate();
    document.getElementById('certificateDate').textContent = `体验日期：${year}年${month}月${day}日`;
    
    // 插入茶百戏成果图片
    const resultImg = document.getElementById('resultImg');
    if(paintingData.length > 0){
      const canvas = document.createElement('canvas');
      canvas.width = 180;
      canvas.height = 180;
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = '#f8f4e9';
      ctx.fillRect(0,0,180,180);
      ctx.strokeStyle = '#8c1c13';
      ctx.lineWidth = 2;
      ctx.lineCap = 'round';
      for(let i=0; i<paintingData.length; i++){
        const path = paintingData[i];
        if(path.length < 2) continue;
        ctx.beginPath();
        ctx.moveTo(path[0].x, path[0].y);
        for(let j=1; j<path.length; j++){
          ctx.lineTo(path[j].x, path[j].y);
        }
        ctx.stroke();
      }
      resultImg.src = canvas.toDataURL('image/png');
    } else {
      resultImg.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Crect width='180' height='180' fill='%23f8f4e9'/%3E%3Ctext x='90' y='95' font-size='14' text-anchor='middle' fill='%23d4c9a8'%3E未绘制图案%3C/text%3E%3C/svg%3E";
    }
  }
}
function sharePage(){
  navigator.share?navigator.share({title:'梦华寻茶录',text:'一起来体验宋代点茶！',url:location.href}).catch(()=>{}):alert('链接已复制，快去分享吧！');
}
function finish(){
  document.getElementById('done').style.display='block';
}

/* 炙茶拖拽（保留原始功能） */
const leaf = document.getElementById('leaf'), roastArea = document.getElementById('roastArea');
let drag = false, ox = 0, oy = 0;
function startDrag(e){
  const t = e.touches? e.touches[0]:e;
  const r = leaf.getBoundingClientRect();
  ox = t.clientX - r.left; oy = t.clientY - r.top; drag = true;
}
function moveDrag(e){
  if(!drag)return;                                              
  const t = e.touches? e.touches[0]:e;
  const par = roastArea.getBoundingClientRect();
  let x = t.clientX - par.left - ox, y = t.clientY - par.top - oy;
  x = Math.max(0, Math.min(x, par.width - leaf.offsetWidth));
  y = Math.max(0, Math.min(y, par.height - leaf.offsetHeight));
  leaf.style.left = x+'px'; leaf.style.top = y+'px'; leaf.style.transform='none';
  const mill = roastArea.querySelector('.mill-stone');
  const mr = mill.getBoundingClientRect(), lr = leaf.getBoundingClientRect();
  if(!(lr.right<mr.left||lr.left>mr.right||lr.bottom<mr.top||lr.top>mr.bottom)){
    // 重置茶叶位置（回到中心）
  leaf.style.left = '50%';
  leaf.style.top = '50%';
  leaf.style.transform = 'translate(-50%,-50%)';
  // 使用完成页同款弹窗提示
  const done=document.getElementById('done');
  done.querySelector('h3').textContent='茶叶已碾磨成粉！';
  done.querySelector('p').textContent='可继续下一步操作';
  done.style.display='block';
  }
}
leaf.addEventListener('touchstart',startDrag);
leaf.addEventListener('mousedown',startDrag);
document.addEventListener('touchmove',moveDrag);
document.addEventListener('mousemove',moveDrag);
document.addEventListener('touchend',()=>drag=false);
document.addEventListener('mouseup',()=>drag=false);

/* 候汤点击加热（保留原始功能） */
let heated=false;
document.getElementById('soupArea').addEventListener('click',()=>{
  if(heated)return;
  const cup=document.querySelector('#soupArea .tea-cup');
  const done=document.getElementById('done');
  done.querySelector('h3').textContent='盏已温热！';
  done.querySelector('p').textContent='可继续下一步操作';
  done.style.display='block';
  cup.style.background='linear-gradient(180deg,#f8f4e9 0%,#d4c9a8 100%)';
  heated=true; setTimeout(()=>cup.style.background='',1000);
  document.getElementById('hotWater').style.opacity = '1';
  setTimeout(() => cup.style.background = '', 1000);
});

/* 取粉拖拽（保留原始功能） */
const spoon=document.getElementById('spoon'), powderArea=document.getElementById('powderArea');
let dragS=false, sx=0,sy=0;
function startSpoon(e){
  const t=e.touches?e.touches[0]:e, r=spoon.getBoundingClientRect();
  sx=t.clientX-r.left; sy=t.clientY-r.top; dragS=true;
}
function moveSpoon(e){
  if(!dragS)return;
  const t=e.touches?e.touches[0]:e, par=powderArea.getBoundingClientRect();
  let x=t.clientX-par.left-sx, y=t.clientY-par.top-sy;
  x=Math.max(0,Math.min(x,par.width-spoon.offsetWidth));
  y=Math.max(0,Math.min(y,par.height-spoon.offsetHeight));
  spoon.style.left=x+'px'; spoon.style.top=y+'px';
  const bowl=powderArea.querySelector('.tea-bowl'), br=bowl.getBoundingClientRect(), sr=spoon.getBoundingClientRect();
  if(!(sr.right<br.left||sr.left>br.right||sr.bottom<br.top||sr.top>br.bottom)){
    bowl.textContent='已取粉';document.getElementById('powderDone').style.display='block'; setTimeout(()=>bowl.textContent='茶盏',1000);
  }
}
spoon.addEventListener('touchstart',startSpoon);
spoon.addEventListener('mousedown',startSpoon);
document.addEventListener('touchmove',moveSpoon);
document.addEventListener('mousemove',moveSpoon);
document.addEventListener('touchend',()=>dragS=false);
document.addEventListener('mouseup',()=>dragS=false);

/* 击拂功能修复（核心修复部分） */
let whiskCount = 0; // 击拂次数计数器
const whiskTool = document.getElementById('whiskTool'); // 确保元素可获取
const whiskProgress = document.getElementById('whiskProgress');
const slideHint = document.getElementById('slideHint');
const whiskNextBtn = document.getElementById('whiskNextBtn');
const whiskBowl = document.getElementById('whiskBowl'); // 茶盏元素

// 简化击拂逻辑，降低触发难度
let lastY = 0; // 记录上一次触摸/鼠标位置
const requiredSlideDistance = 30; // 降低触发阈值（从40px改为30px）

// 触摸事件（移动端核心）
whiskTool.addEventListener('touchstart', (e) => {
  lastY = e.touches[0].clientY;
  slideHint.style.display = 'none';
});

whiskTool.addEventListener('touchmove', (e) => {
  e.preventDefault(); // 阻止页面滚动干扰
  const currentY = e.touches[0].clientY;
  const slideDistance = Math.abs(currentY - lastY);
  
  if (slideDistance >= requiredSlideDistance) {
    // 触发击拂效果
    whiskCount++;
    lastY = currentY; // 更新位置，避免连续触发
    createBubble();
    updateWhiskProgress();
  } else {
    slideHint.style.display = 'block';
  }
});

// 鼠标事件（PC端适配）
whiskTool.addEventListener('mousedown', (e) => {
  lastY = e.clientY;
  slideHint.style.display = 'none';
});

document.addEventListener('mousemove', (e) => {
  if (e.buttons !== 1) return; // 仅鼠标按下时生效
  
  const currentY = e.clientY;
  const slideDistance = Math.abs(currentY - lastY);
  
  if (slideDistance >= requiredSlideDistance) {
    whiskCount++;
    lastY = currentY;
    createBubble();
    updateWhiskProgress();
  } else {
    slideHint.style.display = 'block';
  }
});

// 创建击拂泡沫
function createBubble() {
  const bubble = document.createElement('div');
  bubble.className = 'tea-foam';
  const size = Math.random() * 15 + 8; // 泡沫大小随机
  bubble.style.width = `${size}px`;
  bubble.style.height = `${size}px`;
  // 泡沫仅在茶盏内生成
  const bowlRect = whiskBowl.getBoundingClientRect();
  const areaRect = document.getElementById('whiskArea').getBoundingClientRect();
  const relativeX = Math.random() * (bowlRect.width - size) + bowlRect.left - areaRect.left;
  const relativeY = Math.random() * (bowlRect.height - size) + bowlRect.top - areaRect.top;
  bubble.style.left = `${relativeX}px`;
  bubble.style.top = `${relativeY}px`;
  bubble.style.opacity = '0.8';
  
  document.getElementById('whiskArea').appendChild(bubble);
  
  // 泡沫自动消失
  setTimeout(() => {
    bubble.style.opacity = '0';
    setTimeout(() => bubble.remove(), 300);
  }, 800);
}

// 更新击拂进度
function updateWhiskProgress() {
  let progressText = '';
  if (whiskCount <= 3) {
    progressText = '初现栗纹..';
  } else if (whiskCount <= 6) {
    progressText = '粥面渐起..';
  } else if (whiskCount <= 9) {
    progressText = '沫饶将至..';
  } else {
    progressText = '击拂成功！雪沫浮盏';
    // 生成大量最终泡沫
    for (let i = 0; i < 15; i++) {
      setTimeout(() => createBubble(), i * 50);
    }
    // 启用下一步按钮
    setTimeout(() => {
      whiskNextBtn.disabled = false;
      showPopup('击拂完成', '茶汤已起沫，可进入茶百戏创作');
    }, 800);
  }
  whiskProgress.textContent = progressText;
}

/* 茶百戏功能增强（保留原始绘制，新增撤销/重置） */
const cv=document.getElementById('canvas');
let drawing=false;
let paintingData = []; // 存储绘制路径
let currentPath = [];
const undoBtn = document.getElementById('undoBtn');
const resetBtn = document.getElementById('resetBtn');
const artNextBtn = document.getElementById('artNextBtn');

// 重写茶百戏绘制逻辑
function drawDot(e) {
  const isTouch = e.type.includes('touch');
  const t = isTouch ? e.touches[0] : e;
  const r = cv.getBoundingClientRect();
  const x = t.clientX - r.left;
  const y = t.clientY - r.top;
  
  const dot=document.createElement('div');
  dot.className='drawing-dot';
  dot.style.left=x+'px';
  dot.style.top=y+'px';
  cv.appendChild(dot);
  
  // 记录路径
  currentPath.push({x, y});
}

// 触摸绘制
cv.addEventListener('touchstart',e=>{
  e.preventDefault();
  drawing=true;
  currentPath = [];
  paintingData.push(currentPath);
  drawDot(e);
});
cv.addEventListener('touchmove',e=>{if(drawing)drawDot(e);});
cv.addEventListener('touchend',()=>{
  drawing=false;
  updateArtBtns();
});

// 鼠标绘制
cv.addEventListener('mousedown',e=>{
  drawing=true;
  currentPath = [];
  paintingData.push(currentPath);
  drawDot(e);
});
cv.addEventListener('mousemove',e=>{
  if(drawing)drawDot(e);
});
cv.addEventListener('mouseup',()=>{
  drawing=false;
  updateArtBtns();
});
cv.addEventListener('mouseleave',()=>drawing=false);

// 撤销功能
undoBtn.addEventListener('click', ()=>{
  if(paintingData.length === 0) return;
  paintingData.pop();
  redrawCanvas();
  updateArtBtns();
});

// 重置功能
resetBtn.addEventListener('click', ()=>{
  if(confirm('确定要清除所有绘制内容吗？')){
    paintingData = [];
    redrawCanvas();
    updateArtBtns();
  }
});

// 重绘画布
function redrawCanvas(){
  // 清空画布
  const dots = document.querySelectorAll('#canvas .drawing-dot');
  dots.forEach(dot => dot.remove());
  
  // 重绘路径
  paintingData.forEach(path => {
    path.forEach(point => {
      const dot=document.createElement('div');
      dot.className='drawing-dot';
      dot.style.left=point.x+'px';
      dot.style.top=point.y+'px';
      cv.appendChild(dot);
    });
  });
}

// 更新茶百戏按钮状态
function updateArtBtns(){
  undoBtn.disabled = paintingData.length === 0;
  artNextBtn.disabled = paintingData.length === 0;
}

/* 禁止双击缩放（保留原始功能） */
let lastTouchEnd=0;
document.addEventListener('touchend',e=>{
  const now=(new Date()).getTime();
  if(now-lastTouchEnd<=300)e.preventDefault();
  lastTouchEnd=now;
},false);

function closeDone(){
  document.getElementById('done').style.display='none';
}
function closePowderDone(){
  document.getElementById('powderDone').style.display='none';
}

/* 3D建盏模型初始化 */
let scene, camera, renderer, controls;
function init3DModel(){
  const container = document.getElementById('modelContainer');
  if(!container) return; // 避免容器不存在时报错
  
  // 场景
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0xe8e0d1);
  
  // 相机
  camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
  camera.position.z = 5;
  
  // 渲染器
  renderer = new THREE.WebGLRenderer({antialias: true});
  renderer.setSize(container.clientWidth, container.clientHeight);
  container.appendChild(renderer.domElement);
  
  // 灯光
  const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
  scene.add(ambientLight);
  
  const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
  directionalLight.position.set(5, 5, 5);
  scene.add(directionalLight);
  
  // 建盏模型（简化版，确保加载成功）
  const bowlGeometry = new THREE.SphereGeometry(1.2, 32, 32);
  const bowlMaterial = new THREE.MeshStandardMaterial({
    color: 0x3a2e26,
    metalness: 0.7,
    roughness: 0.3,
    // 使用简单纹理，避免base64编码问题
    map: new THREE.CanvasTexture(createTextureCanvas()),
    normalMap: new THREE.CanvasTexture(createNormalCanvas())
  });
  
  // 创建纹理画布（避免外部资源依赖）
  function createTextureCanvas() {
    const canvas = document.createElement('canvas');
    canvas.width = 256;
    canvas.height = 256;
    const ctx = canvas.getContext('2d');
    // 绘制建盏纹理
    const gradient = ctx.createRadialGradient(128, 128, 0, 128, 128, 128);
    gradient.addColorStop(0, '#5c4a3d');
    gradient.addColorStop(0.8, '#3a2e26');
    gradient.addColorStop(1, '#2a2018');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, 256, 256);
    return canvas;
  }
  
  // 创建法线贴图画布
  function createNormalCanvas() {
    const canvas = document.createElement('canvas');
    canvas.width = 256;
    canvas.height = 256;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#808080';
    ctx.fillRect(0, 0, 256, 256);
    return canvas;
  }
  
  const bowlMesh = new THREE.Mesh(bowlGeometry, bowlMaterial);
  scene.add(bowlMesh);
  
  // 控制器
  controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableZoom = true;
  controls.enableRotate = true;
  controls.enablePan = false;
  controls.minDistance = 3;
  controls.maxDistance = 8;
  
  // 窗口适配
  window.addEventListener('resize', ()=>{
    if(!container) return;
    camera.aspect = container.clientWidth / container.clientHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(container.clientWidth, container.clientHeight);
  });
  
  // 渲染循环
  function animate(){
    requestAnimationFrame(animate);
    controls.update();
    renderer.render(scene, camera);
  }
  animate();
}

/* 分享与保存功能 */
const shareBtn = document.getElementById('shareBtn');
const saveBtn = document.getElementById('saveBtn');
const shareOptions = document.getElementById('shareOptions');
const wechatShare = document.getElementById('wechatShare');
const momentsShare = document.getElementById('momentsShare');
const weiboShare = document.getElementById('weiboShare');

// 打开分享选项
shareBtn.addEventListener('click', ()=>{
  shareOptions.style.display = 'block';
});

// 关闭分享选项
function closeShareOptions(){
  shareOptions.style.display = 'none';
}

// 平台分享逻辑
wechatShare.addEventListener('click', ()=>{
  const text = document.querySelector('.share-input').value;
  navigator.clipboard.writeText(text).then(()=>{
    showPopup('微信分享', '分享文案已复制，\n请在微信粘贴发送给好友');
  }).catch(()=>{
    showPopup('微信分享', `分享文案：\n${text}\n请手动复制发送`);
  });
  closeShareOptions();
});

momentsShare.addEventListener('click', ()=>{
  const text = document.querySelector('.share-input').value;
  navigator.clipboard.writeText(text).then(()=>{
    showPopup('朋友圈分享', '分享文案已复制，\n请在朋友圈粘贴发布');
  }).catch(()=>{
    showPopup('朋友圈分享', `分享文案：\n${text}\n请手动复制发布`);
  });
  closeShareOptions();
});

weiboShare.addEventListener('click', ()=>{
  const text = document.querySelector('.share-input').value;
  const shareUrl = `https://service.weibo.com/share/share.php?text=${encodeURIComponent(text)}&url=${encodeURIComponent(location.href)}`;
  window.open(shareUrl, '_blank', 'width=600,height=400');
  closeShareOptions();
});

// 保存证书功能
saveBtn.addEventListener('click', ()=>{
  const certificate = document.querySelector('.certificate');
  
  if(typeof html2canvas !== 'undefined'){
    html2canvas(certificate, {
      scale: 2,
      useCORS: true,
      logging: false,
      backgroundColor: '#ffffff'
    }).then(canvas => {
      const link = document.createElement('a');
      const date = new Date();
      const year = date.getFullYear();
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const day = date.getDate().toString().padStart(2, '0');
      const fileName = `梦华寻茶录_点茶体验证书_${year}${month}${day}.png`;
      
      link.download = fileName;
      link.href = canvas.toDataURL('image/png');
      link.style.display = 'none';
      
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showPopup('保存成功', '证书已保存至本地下载文件夹\n（手机端在相册/文件管理中查找）');
    }).catch(err => {
      console.error('证书保存失败：', err);
      showPopup('保存失败', '请检查浏览器权限\n或刷新页面后重试');
    });
  } else {
    showPopup('依赖加载失败', 'html2canvas未加载完成，请稍后再试');
  }
});

// 通用弹窗功能优化
function showPopup(title, content){
  const done = document.getElementById('done');
  done.querySelector('h3').textContent = title;
  done.querySelector('p').textContent = content;
  done.style.display = 'block';
  
  setTimeout(()=>{
    if(done.style.display === 'block'){
      closeDone();
    }
  }, 3000);
}

// 页面初始化
window.onload = function(){
  // 延迟初始化3D模型，避免加载卡顿
  setTimeout(init3DModel, 1000);
  
  // 点击弹窗外部关闭弹窗
  window.addEventListener('click', (e)=>{
    const done = document.getElementById('done');
    if(e.target === done){
      closeDone();
    }
    if(e.target === shareOptions){
      closeShareOptions();
    }
  });
  
  // 初始化时更新茶百戏按钮状态
  updateArtBtns();
  
  // 初始化击拂工具位置（确保可见）
  const whiskTool = document.getElementById('whiskTool');
  if(whiskTool){
    whiskTool.style.left = '50%';
    whiskTool.style.top = '50%';
    whiskTool.style.transform = 'translate(-50%, -50%)';
  }
};
</script>

</body></html>